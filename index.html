---
layout: default
title: Kommu
---
<style>
  :root {
    --spring-offset: 0; /* set e.g. 80 for fixed headers in px */
  }
  body {
    background-color: #000;
  }
  html {
    background-color: #000;
  }
  .scrollbar-hide::-webkit-scrollbar { display: none; }
  .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  /* Full-bleed row that doesn’t expand page width */
  .full-bleed-row { width: 100vw; position: relative; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw; box-sizing: border-box; }
  /* Align rows to 1100px container center, keep 1rem right spacing */
  .row-align { 
    padding-left: max(calc((100vw - 1100px) / 2), 1.5rem); 
    padding-right: max(calc((100vw - 1100px) / 2), 1.5rem); 
    gap: 3.5rem;
  }

  html, body { overflow-x: hidden; }

  

  

  .brand-logo {
    width: 7.5rem;   
    height: auto;
  }

  /*Whatsapp Chat Bot button*/
  .whatsapp-float {
    position: fixed;
    /* base offset from the design baseline */
    bottom: calc(32px + env(safe-area-inset-bottom, 0px));
    right: 32px;
    /* counter the dynamic 100vh change so the button doesn't jump */
    transform: translateY(calc(100vh - (var(--vh, 1vh) * 100)));
    will-change: transform;
    z-index: 1000;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: rgb(255 255 255 / 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 4px rgba(255, 255, 255, 0.2);
  }
  .whatsapp-float img {
    width: 32px;
    height: 32px;
  }
  .whatsapp-float:hover {
    background-color: rgb(255 255 255 / 0.3);
    box-shadow: 0 0 4px rgba(255, 255, 255, 0.9);
  }

  .whatsapp-float i {
    color: rgb(255 255 255 / 0.6); 
  }

  .whatsapp-float:hover i {
    color: rgb(255 255 255 / 0.8);
  }


  /* --- Scroll Snap (full-screen sections) --- */
  /* Ensure each hero/feature section fills the viewport and snaps cleanly */
  .snap-off {
    scroll-snap-type: none !important;
  }
  /* Horizontal carousel controls (Apple-style) */
  .carousel-wrap { position: relative; }
  .h-scroll { scroll-behavior: smooth; }
  .scroll-btn {
    position: absolute;
    bottom: -30px; /* sit just under the cards row */
    width: 42px; height: 42px; border-radius: 9999px;
    display: grid; place-items: center;
    background: rgb(255 255 255 / 0.6);
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.25);
    border: 0;
    z-index: 10;
    cursor: pointer;
    transition: transform .15s ease, background-color .15s ease, opacity .15s ease;
  }
  .scroll-btn:hover { transform: scale(1.06); background: rgb(255 255 255 / 0.9); }
  .scroll-btn:active { transform: scale(0.98); }
  .scroll-btn[disabled] { opacity: .4; pointer-events: none; }
  .scroll-btn.next { right: 1.25rem; transform: none; }
  .scroll-btn.prev { right: calc(1.25rem + 42px + 24px); transform: none; } /* 36px button + 8px gap */
  .scroll-btn svg { width: 18px; height: 18px; }

  /*Lock content height while browser UI hide/show*/
:root { --vh: 1vh; }
.hp1-content-height{
  min-height: calc(var(--vh, 1vh) * 100);
}
.hp2-content-height{
  min-height: calc(var(--vh, 1vh) * 80);
}
.hp3-content-height{
  min-height: calc(var(--vh, 1vh) * 80);
}
.hp4-content-height{
  min-height: calc(var(--vh, 1vh) * 100);
}

  /* --- Consolidated Breakpoints --- */

  :root { 
    --card-w: 350px; 
    --card-h: 700px;          /* total card height */
    --card-img-h: 437.5px;      /* image height inside the card */
  }

  @media (max-width: 1280px) {
    .row-align { 
      gap: 2.5rem;
    }
    :root { 
      --card-w: 300px;
      --card-h: 500px;
      --card-img-h: 375px; }
    .brand-logo {
      width: 6rem; /* 100px */
    }
  }
  @media (max-width: 380px) {
    :root { 
      --card-w: 280px; 
      --card-h: 500px; 
      --card-img-h: 350px; 
    }
  }

  @media (max-width: 768px) {
    .row-align { 
      gap: 1.5rem;
    }
    .brand-logos-grid {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr);
      justify-items: center;
      gap: 0.5rem;
    }
    .hero-overlay {
      padding-bottom: 3rem; /* pb-12 */
    }
    .whatsapp-float {
      bottom: calc(100px + env(safe-area-inset-bottom, 0px));
      right: 16px;
      transform: translateY(calc(100vh - (var(--vh, 1vh) * 100)));
    }
    .btn-check-models {
      margin-top: 2rem; /* my-8 */
      margin-bottom: 2rem; /* my-8 */
    }
    .page-snap {
      scroll-snap-type: y proximity;
      scroll-behavior: smooth; /* gentle anchor jumps */
      scroll-padding-top: 10vh;
      scroll-padding-bottom: 12vh;
    }
    section.dvh-100,
    section.dvh-110,
    section.dvh-120 {
      scroll-snap-align: start;
    }
    section.dvh-110 {
      min-height: 900px;
    }
    .scroll-btn { bottom: -8px; width: 36px; height: 36px; }
    .scroll-btn svg { width: 16px; height: 16px; }
    .scroll-btn.next { right: 0.5rem; }
    .scroll-btn.prev { right: calc(0.5rem + 36px + 18px); } /* 32px button + 8px gap */
    .software-section {
      min-height: 900px;
    }
    .hardware-section {
      min-height: 900px;
    }
    .hp4-content-height{
      min-height: calc(var(--vh, 1vh) * 80);
    }
  }

  .fixed-card {
    width: var(--card-w);
    min-width: var(--card-w);
    max-width: var(--card-w);
    height: var(--card-h);
    overflow: hidden;           /* keep consistent height */
    display: flex;
    flex-direction: column;
  }
  /* Double-width variation */
  .fixed-card.wide {
    width: calc(var(--card-w) * 2);
    min-width: calc(var(--card-w) * 2);
    max-width: calc(var(--card-w) * 2);
  }

  /* Ensure images don’t grow the card vertically. Keep same height for normal and wide cards */
  .fixed-card img {
    height: var(--card-img-h);
    width: 100%;
    object-fit: cover;
    flex: 0 0 auto;
    background-color: rgb(27 27 27 / var(--tw-bg-opacity, 1));
  }

  @media (max-width: 768px) {
      .fixed-card.wide {
      width: calc(var(--card-w) * 1);
      min-width: calc(var(--card-w) * 1);
      max-width: calc(var(--card-w) * 1);
    }
  }



/* IPAD HORIZONTAL */
@media (max-height: 1100px) and (min-width: 1100px) {
  .hero-overlay {
    padding-bottom: 2rem; /* pb-8 */
  }
  .software-section {
    min-height: 900px;
  }
  .hardware-section {
    min-height: 900px;
  }
}
@media (max-height: 1280px) and (min-width: 768px) {
  .brand-logos-grid {
    width: 100% !important;
    max-width: none !important; /* override Tailwind's max-w-[720px] */
  }
}





  /* Vignette overlay for home hero video (match ka2 s1) */
  .home-vignette {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 5; /* below .hero-overlay (z-10), above video */
    background-image:
      radial-gradient(120% 120% at 50% 40%, rgba(0,0,0,0) 55%, rgba(0,0,0,0.55) 100%),
      linear-gradient(to bottom, rgba(0,0,0,0) 60%, rgba(0,0,0,1) 100%);
    background-size: 100% 100%, 100% 100%;
    background-position: center center, center bottom;
    background-repeat: no-repeat, no-repeat;
  }
</style>

<script>
  // Hard-lock --vh once; only refresh on orientation change
  (function lockOnce() {
    const apply = () => {
      const vh = window.innerHeight * 0.01; // 1% of current layout viewport
      document.documentElement.style.setProperty('--vh', vh + 'px');
    };
    apply();
    // Update only on major changes like device rotation
    window.addEventListener('orientationchange', apply);
  })();
</script>

<!-- HOME VIDEO -->
<main class="page-snap">
<section id="home" class="relative overflow-hidden">
  <div class="hp1-content-height">
  <video
    class="absolute inset-0 w-full h-full object-cover"
    autoplay muted loop playsinline
    src="{{ "/assets/ytvid.mp4" | relative_url }}"
  ></video>
  <div class="home-vignette" aria-hidden="true"></div>
  <div class="absolute inset-0 z-10 flex flex-col items-center justify-end pb-32 text-center px-4 hero-overlay">
    <h2 class="h2 text-white">
      Elevate your driving experience with L2+ ADAS
    </h2>
    <h3 class="h3 text-gray-light">
      Drive smarter and safer with KommuAssist
    </h3>
    <div class="mt-6 space-x-6">
      <a
        href="{{ '/store' | relative_url }}"
        class="h4 text-blue-500 hover:underline"
      >Buy Now ›</a>
      <a
        href="{{ '/ka2' | relative_url }}"
        class="h4 text-blue-500 hover:underline"
      >Learn More ›</a>
    </div>
  </div>
  </div>
</section>

<!-- HARDWARE -->
<section class="flex hardware-section">
  <div class="max-w-6xl mx-auto pt-35 px-4 hp2-content-height">
    <h4 class="h3 text-gray-light">Hardware</h4>
    <h1 class="h1 font-bold text-white mt-1 mb-2">KommuAssist 2.0</h1>
    <p class="h4 font-bold text-gray mb-8">
      Whole new level of edge computing with 6 TOPS NPU and 3× automotive‑grade cameras. Designed for reliability, built for fast neural processing.
    </p>
    
   <div class="carousel-wrap">
     <div class="h-scroll flex flex-nowrap overflow-x-auto overflow-y-visible scrollbar-hide full-bleed-row row-align pb-14" id="hw-cards">
      <div class="fixed-card">
        <img src="{{ '/img/main/hw1.png' | relative_url }}" alt="RK3588" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">RK3588 at the core.</h4>
        <p class="h5 text-gray mt-2">
          On-device neural processing. 6 TOPS NPU acceleration for real‑time vision inference.
        </p>
      </div>


      <div class="fixed-card">
        <img src="{{ '/img/main/hw2.png' | relative_url }}" alt="3x cameras" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">3× automotive cameras.</h4>
        <p class="h5 text-gray mt-2">
          Synchronized wide‑angle and long range perception built for automotive‑grade vision.
        </p>
      </div>

      <div class=" fixed-card wide">
        <img src="{{ '/img/main/hw3-2.png' | relative_url }}" alt="Cool by design" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">Cool by design.</h4>
        <p class="h5 text-gray mt-2">
          CNC-machined aluminum unibody doubles as a passive heatsink for sustained performance.
        </p>
      </div>

      <div class=" fixed-card">
        <img src="{{ '/img/main/hw4.png' | relative_url }}" alt="Sleek curves" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">Sleek curves.</h4>
        <p class="h5 text-gray mt-2">
          Fanless, screenless module that tucks behind the mirror—no clutter, just capability.
        </p>
      </div>

      <div class=" fixed-card">
        <img src="{{ '/img/main/hw5.png' | relative_url }}" alt="Seamless connectivity" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">Seamless connectivity.</h4>
        <p class="h5 text-gray mt-2">
          Equipped with LTE, GPS, Wi-Fi, Bluetooth and local storage. Also works with the new KommuAI app.
        </p>
      </div>
    </div>
    <button class="scroll-btn prev" type="button" aria-label="Scroll left" data-for="hw-cards">
      <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.5 15L7.5 10L12.5 5" stroke="#000" stroke-opacity=".8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <button class="scroll-btn next" type="button" aria-label="Scroll right" data-for="hw-cards">
      <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 5L12.5 10L7.5 15" stroke="#000" stroke-opacity=".8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
  </div>
  </div>
</section>

<!-- SOFTWARE -->
<section class="flex software-section">
  <div class="max-w-6xl mx-auto pt-10 px-4 hp3-content-height">
    <h4 class="h3 text-gray-light">Software</h4>
    <h1 class="h1 font-bold text-white mt-1 mb-2">bukapilot v10</h1>
    <p class="h4 font-bold text-gray mb-8">
      bukapilot is a community‑driven, open‑source fork of openpilot, featuring an advanced driving AI model with over 100 million miles driven by a growing user base of 10,000+ all across the globe.
    </p>
    
    <div class="carousel-wrap">
      <div class="h-scroll flex flex-nowrap overflow-x-auto overflow-y-visible gap-11 scrollbar-hide full-bleed-row row-align pb-14" id="sw-cards">
      <div class=" fixed-card">
        <img src="{{ '/img/main/sample.png' | relative_url }}" alt="RK3588" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">ADAS driving agent.</h4>
        <p class="h5 text-gray mt-2">
          End‑to‑end neural network. Integrated ADAS stack—lateral + longitudinal, driver monitoring and more.
        </p>
        </p>
      </div>

      <div class=" fixed-card">
        <img src="{{ '/img/main/sample.png' | relative_url }}" alt="3x cameras" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">Understands the road.</h4>
        <p class="h5 text-gray mt-2">
          Smart enough to spot traffic lights, speed bumps, and safely change lanes.
        </p>
      </div>

      <div class=" fixed-card wide">
        <img src="{{ '/img/main/hw1.png' | relative_url }}" alt="Kommunity" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">Driven by Kommunity.</h4>
        <p class="h5 text-gray mt-2">
          Always evolving. Backed by a growing community building features, fixes, and fresh ideas.
        </p>
      </div>

      <div class=" fixed-card">
        <img src="{{ '/img/main/sample.png' | relative_url }}" alt="Mounts like magic" class="w-full mb-4 rounded-3xl">
        <h4 class="h3 font-bold text-white">Safety‑focused.</h4>
        <p class="h5 text-gray mt-2">
          Observed ISO26262 Functional Safety Standard & MISRA C code compliant.
        </p>
      </div>
    </div>
    <button class="scroll-btn prev" type="button" aria-label="Scroll left" data-for="sw-cards">
      <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.5 15L7.5 10L12.5 5" stroke="#000" stroke-opacity=".8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <button class="scroll-btn next" type="button" aria-label="Scroll right" data-for="sw-cards">
      <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 5L12.5 10L7.5 15" stroke="#000" stroke-opacity=".8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
  </div>
  </div>
</section>

<!-- COMPATIBILITY -->
<section class="flex items-center car-compatible-section">
  <div class="max-w-6xl mx-auto pt-20 px-4 hp4-content-height">
    <div class="bg-card rounded-2xl py-8 px-12 md:py-12 md:px-16 text-center text-white">
      <h3 class="h1 font-bold text-white max-w-[720px] mx-auto">KommuAssist is compatible with these car models.</h3>
      <a
        href="{{ '/support' | relative_url }}"
        class="h5 inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full my-12 btn-check-models"
      >Check Car Models</a>
      <div class="flex flex-wrap justify-center gap-x-12 gap-y-8 mx-auto max-w-[720px] brand-logos-grid">
        <!-- logos -->
        <img src="{{ '/img/main/perodua.png' | relative_url }}" alt="Perodua" class="brand-logo object-contain" />
        <img src="{{ '/img/main/proton.png'  | relative_url }}" alt="Proton"  class="brand-logo object-contain" />
        <img src="{{ '/img/main/honda.png'   | relative_url }}" alt="Honda"   class="brand-logo object-contain" />
        <img src="{{ '/img/main/toyota.png'  | relative_url }}" alt="Toyota"  class="brand-logo object-contain" />
        <img src="{{ '/img/main/byd.png'     | relative_url }}" alt="BYD"     class="brand-logo object-contain" />
        <img src="{{ '/img/main/lexus.png'   | relative_url }}" alt="Lexus"   class="brand-logo object-contain" />
      </div>
      <div class="mt-8 hidden sm:grid grid-cols-2 md:grid-cols-4 gap-10 text-left text-sm">
        <div>
          <p class="h4 font-bold my-2">Perodua</p>
          <p class="h5 text-gray font-normal my-1">Myvi (2022–2025 AV)</p>
          <p class="h5 text-gray font-normal my-1">Ativa (2019–2025 AV)</p>
          <p class="h5 text-gray font-normal my-1">Alza (2022–2025 AV)</p>
        </div>
        <div>
          <p class="h4 font-bold my-2">Proton</p>
          <p class="h5 text-gray font-normal my-1">S70 (2024–2025 Flagship, FSX)</p>
          <p class="h5 text-gray font-normal my-1">X50 (2019–2025 Flagship)</p>
          <p class="h5 text-gray font-normal my-1">X70 (2024–2025 Premium, Premium X)</p>
          <p class="h5 text-gray font-normal my-1">X90 (2023–2025 Premium, Flagship)</p>
        </div>
        <div>
          <p class="h4 font-bold my-2">Honda</p>
          <p class="h5 text-gray font-normal my-1">City (2019–2025 V-Sensing, RS)</p>
          <p class="h5 text-gray font-normal my-1">City FL (2024–2025 RS ybrid)</p>
          <p class="h5 text-gray font-normal my-1">Civic FE (2022–2025)</p>
        </div>
        <div>
          <p class="h4 font-bold my-2">Toyota</p>
          <p class="h5 text-gray font-normal my-1">Vios (2023–2025 G)</p>
          <p class="h5 text-gray font-normal my-1">Veloz (2022–2025 AT)</p>
          <p class="h5 text-gray font-normal my-1">Cross (2022–2025 V, Hybrid)</p>
          <p class="h5 text-gray font-normal my-1">Altis TSS2.0 (2019–2025 G, Hybrid)</p>
          <p class="h5 text-gray font-normal my-1">Alphard TSS2.0 (2019–2025)</p>
        </div>
        <div>
          <p class="h4 font-bold my-2">BYD</p>
          <p class="h5 text-gray font-normal my-1">Atto 3 (2023–2025 All)</p>
        </div>
        <div>
          <p class="h4 font-bold my-2">Lexus</p>
          <p class="h5 text-gray font-normal my-1">ES (2019–2024 All)</p>
          <p class="h5 text-gray font-normal my-1">NX (2020–2024 All)</p>
          <p class="h5 text-gray font-normal my-1">UX (2020–2024 All)</p>
          <p class="h5 text-gray font-normal my-1">RX (2020–2024 All)</p>
        </div>
      </div>
    </div>
  </div>
</section>
<a href="https://wa.me/15558229640" target="_blank" class="whatsapp-float">
  <i class="fab fa-whatsapp fa-xl"></i>
</a>
</main>


<script>
(function () {
  // Apply only on touch devices to mimic iOS-native feel
  const isTouch = matchMedia('(hover: none)').matches || 'ontouchstart' in window;

  // Damped spring scroll (iOS-like): configurable mass-spring-damper
  // Based on underdamped harmonic motion solution.
  function springInterpolation(t, opts) {
    const { stiffness = 170, damping = 26, mass = 1 } = opts || {};
    // Convert to angular frequencies
    const w0 = Math.sqrt(stiffness / mass);          // undamped natural frequency
    const zeta = damping / (2 * Math.sqrt(stiffness * mass)); // damping ratio
    if (zeta >= 1) {
      // Critically/over-damped fallback to smooth easeOut
      return 1 - Math.exp(-t * w0);
    }
    const wd = w0 * Math.sqrt(1 - zeta * zeta);      // damped natural frequency
    // Normalized time in seconds (t in [0,1] assumed)
    const A = 1;
    const B = (zeta / Math.sqrt(1 - zeta * zeta));
    // y(t) from 0 -> 1 with slight overshoot depending on zeta
    return 1 - Math.exp(-zeta * w0 * t) * (Math.cos(wd * t) + B * Math.sin(wd * t));
  }

  // Main animator using requestAnimationFrame
  function springScrollTo(targetY, options) {
    const {
      duration = 1200,                 // ms baseline for typical distances
      stiffness = 180,                 // higher = snappier
      damping = 24,                    // higher = less overshoot
      mass = 1,
      offset = 0                       // e.g., use to account for fixed headers
    } = options || {};

    const start = window.scrollY || window.pageYOffset;
    const end = Math.max(0, Math.min(
      targetY - offset,
      document.documentElement.scrollHeight - window.innerHeight
    ));
    const distance = end - start;
    if (Math.abs(distance) < 1) return; // nothing to do

    // Optionally scale duration with distance for consistent feel
    const px = Math.abs(distance);
    const dur = Math.min(1800, Math.max(600, duration * (px / 1200) ** 0.5));

    let startTime = null;
    function frame(ts) {
      if (!startTime) startTime = ts;
      const t = (ts - startTime) / dur;
      if (t >= 1) {
        window.scrollTo(0, end);
        if (options && typeof options.onDone === 'function') {
          options.onDone();
        }
        return;
      }
      // Convert t (0..1) to "seconds" domain for spring math
      const seconds = t * 1.2; // stretch factor to tune feel
      const p = springInterpolation(seconds, { stiffness, damping, mass });
      window.scrollTo(0, start + distance * p);
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  }

  // Convenience: scroll to an element
  function springScrollToElement(el, opts) {
    const rect = el.getBoundingClientRect();
    const targetY = rect.top + window.scrollY;
    springScrollTo(targetY, opts);
  }

  // Auto-bind anchor links like <a href="#section-id">...</a> on touch devices
  if (isTouch) {
    document.addEventListener('click', function (e) {
      const a = e.target.closest('a[href^="#"]');
      if (!a) return;
      const href = a.getAttribute('href');
      const id = href.slice(1);
      if (!id) return;
      const target = document.getElementById(id);
      if (!target) return;
      e.preventDefault();
      // Optional: account for any top padding you set via scroll-padding-top
      const offset = Math.round((parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--spring-offset')) || 0));
      const snapContainer = document.querySelector('.page-snap');
      if (snapContainer) snapContainer.classList.add('snap-off');
      springScrollToElement(target, {
        duration: 1200,
        stiffness: 220,
        damping: 30,
        mass: 1,
        offset,
        onDone: () => {
          if (snapContainer) snapContainer.classList.remove('snap-off');
        }
      });
    }, { passive: false });
  }

  // Expose programmatic API if you want to call it elsewhere:
  window.springScrollTo = springScrollTo;
  window.springScrollToElement = springScrollToElement;

  // ---- Horizontal scroll buttons ----
  function bindScrollButtons(wrapper) {
    const scroller = wrapper.querySelector('.h-scroll');
    if (!scroller) return;
    const prevBtn = wrapper.querySelector('.scroll-btn.prev');
    const nextBtn = wrapper.querySelector('.scroll-btn.next');
    if (!prevBtn || !nextBtn) return;

    // Collect all card elements and compute their left offsets for precise snapping
    const cards = Array.from(scroller.querySelectorAll('.fixed-card'));

    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    const getStops = () => {
      // account for left padding on the scroller (.row-align adds it)
      const cs = getComputedStyle(scroller);
      const padL = parseFloat(cs.paddingLeft) || 0;
      return cards.map(el => Math.round(el.offsetLeft - padL));
    };
    const getMax = () => scroller.scrollWidth - scroller.clientWidth;

    const updateDisabled = () => {
      const max = getMax();
      const x = scroller.scrollLeft;
      prevBtn.disabled = x <= 4;
      nextBtn.disabled = x >= max - 4;
    };

    const scrollByStep = (dir) => {
      const stops = getStops();
      const max = getMax();
      const from = Math.round(scroller.scrollLeft);

      // Find the next or previous stop relative to current position
      let target;
      if (dir > 0) {
        target = stops.find(s => s > from + 4); // forward
        if (target === undefined) target = max; // end
      } else {
        const prevs = stops.filter(s => s < from - 4);
        target = prevs.length ? prevs[prevs.length - 1] : 0; // start
      }
      scroller.scrollTo({ left: clamp(target, 0, max), behavior: 'smooth' });
    };

    prevBtn.addEventListener('click', () => scrollByStep(-1));
    nextBtn.addEventListener('click', () => scrollByStep(1));

    scroller.addEventListener('scroll', updateDisabled, { passive: true });
    window.addEventListener('resize', updateDisabled);
    // init
    updateDisabled();
  }

  document.querySelectorAll('.carousel-wrap').forEach(bindScrollButtons);
})();
</script>